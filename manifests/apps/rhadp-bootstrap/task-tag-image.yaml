kind: ClusterTask
apiVersion: tekton.dev/v1beta1
metadata:
  name: tag-image
spec:
  description: Nothing to do
  params:
    - name: source-image-tag
      description: URL of the image to be copied to the destination registry
      type: string
      default: ""
    - name: target-image-tag
      description: URL of the image where the image from source should be copied to
      type: string
      default: ""
  steps:
    - name: tag-image
      image: quay.io/skopeo/stable:latest
      env:
        - name: HOME
          value: /tekton/home
      resources: {}
      script: |
        #!/usr/bin/env bash

        #ls -la /workspace/dockerconfig
        #cat /workspace/dockerconfig/config.json

        echo "source-image: $(params.source-image-tag)"
        echo "target-image: $(params.target-image-tag)"

        skopeo copy --authfile=/workspace/dockerconfig/config.json $(params.source-image-tag) $(params.target-image-tag)

        #skopeo copy docker://${source-image} docker://${target-image}

      securityContext:
        runAsNonRoot: true
        runAsUser: 65532

  workspaces:
    - name: dockerconfig
      description: Includes a docker `config.json`
      optional: true
